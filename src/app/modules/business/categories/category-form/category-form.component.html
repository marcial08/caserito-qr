<div class="category-form-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div>
        <h1 class="page-title">{{ formTitle }}</h1>
        <p class="page-subtitle">
          {{ isEditMode ? 'Modifica los datos de la categoría' : 'Crea una nueva categoría para organizar tus productos' }}
        </p>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline" (click)="onCancel()">
          <i class="fa fa-times me-2"></i>
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <!-- <div class="loading-container">
      <app-loading-spinner [message]="isEditMode ? 'Cargando categoría...' : 'Preparando formulario...'"></app-loading-spinner>
    </div> -->
  }

  <!-- Form Content -->
  @if (!isLoading) {
    <div class="form-content">
      <div class="form-container">
        <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()" class="category-form">
          <div class="form-grid">
            <!-- Left Column: Basic Info -->
            <div class="form-section">
              <div class="section-header">
                <h3 class="section-title">
                  <i class="fa fa-info-circle me-2"></i>
                  Información Básica
                </h3>
                <p class="section-subtitle">Información principal de la categoría</p>
              </div>

              <div class="form-group">
                <label class="form-label required" for="name">
                  Nombre de la Categoría
                </label>
                <input
                  type="text"
                  id="name"
                  class="form-control"
                  [class.is-invalid]="hasError('name', 'required')"
                  formControlName="name"
                  placeholder="Ej: Entradas, Platos Principales, Postres..."
                />
                @if (hasError('name', 'required')) {
                  <div class="invalid-feedback">
                    El nombre es requerido
                  </div>
                }
                @if (hasError('name', 'maxlength')) {
                  <div class="invalid-feedback">
                    Máximo 100 caracteres
                  </div>
                }
                <small class="form-help">
                  El nombre que verán tus clientes en el menú
                </small>
              </div>

              <div class="form-group">
                <label class="form-label" for="description">
                  Descripción
                </label>
                <textarea
                  id="description"
                  class="form-control"
                  [class.is-invalid]="hasError('description', 'maxlength')"
                  formControlName="description"
                  rows="4"
                  placeholder="Describe brevemente esta categoría (opcional)"
                ></textarea>
                @if (hasError('description', 'maxlength')) {
                  <div class="invalid-feedback">
                    Máximo 500 caracteres
                  </div>
                }
                <small class="form-help">
                  {{ categoryForm.get('description')?.value?.length || 0 }}/500 caracteres
                </small>
              </div>

              <div class="form-grid-inline">
                <div class="form-group">
                  <label class="form-label required" for="display_order">
                    Orden de Visualización
                  </label>
                  <input
                    type="number"
                    id="display_order"
                    class="form-control"
                    [class.is-invalid]="hasError('display_order', 'required') || hasError('display_order', 'min')"
                    formControlName="display_order"
                    min="0"
                    step="1"
                  />
                  @if (hasError('display_order', 'required')) {
                    <div class="invalid-feedback">
                      El orden es requerido
                    </div>
                  }
                  @if (hasError('display_order', 'min')) {
                    <div class="invalid-feedback">
                      El orden debe ser mayor o igual a 0
                    </div>
                  }
                  <small class="form-help">
                    Define el orden en el menú (número más bajo aparece primero)
                  </small>
                </div>

                <div class="form-group">
                  <label class="form-label" for="is_active">
                    Estado
                  </label>
                  <div class="form-check form-switch mt-2">
                    <input
                      type="checkbox"
                      id="is_active"
                      class="form-check-input"
                      role="switch"
                      formControlName="is_active"
                    />
                    <label class="form-check-label" for="is_active">
                      Categoría activa
                    </label>
                  </div>
                  <small class="form-help">
                    Las categorías inactivas no se muestran en el menú público
                  </small>
                </div>
              </div>
            </div>

            <!-- Right Column: Image Upload -->
            <div class="form-section">
              <div class="section-header">
                <h3 class="section-title">
                  <i class="fa fa-image me-2"></i>
                  Imagen de Portada
                </h3>
                <p class="section-subtitle">Agrega una imagen representativa (opcional)</p>
              </div>

              <div class="image-upload-section">
                <!-- Image Preview -->
                @if (imagePreview) {
                  <div class="image-preview-container">
                    <img [src]="imagePreview" alt="Vista previa" class="image-preview">
                    <button type="button" class="image-remove-btn" (click)="removeImage()" title="Remover imagen">
                      <i class="fa fa-times"></i>
                    </button>
                  </div>
                  <small class="form-help">
                    Haz clic en la imagen para cambiarla
                  </small>
                }

                <!-- Upload Area -->
                <div class="upload-area" [class.has-image]="imagePreview">
                  @if (isUploadingImage) {
                    <div class="uploading-overlay">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Subiendo...</span>
                      </div>
                      <p class="mt-2 mb-0">Subiendo imagen...</p>
                    </div>
                  } @else {
                    <div class="upload-content">
                      <i class="fa fa-cloud-upload-alt upload-icon"></i>
                      <p class="upload-text">
                        {{ imagePreview ? 'Cambiar imagen' : 'Arrastra o haz clic para subir' }}
                      </p>
                      <p class="upload-subtext">
                        JPG, PNG o WebP (máx. 5MB)
                      </p>
                    </div>
                    <input
                      type="file"
                      #fileInput
                      class="file-input"
                      accept="image/jpeg,image/png,image/jpg,image/webp"
                      (change)="onFileSelected($event)"
                    />
                  }
                </div>

                <!-- Image Info -->
                <div class="image-info">
                  <div class="info-item">
                    <i class="fa fa-info-circle text-primary me-2"></i>
                    <span>Recomendado: 800x400px o proporción 2:1</span>
                  </div>
                  <div class="info-item">
                    <i class="fa fa-eye text-primary me-2"></i>
                    <span>La imagen debe ser clara y representativa</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-outline" (click)="onCancel()">
              <i class="fa fa-times me-2"></i>
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
              @if (isSubmitting) {
                <span>
                  <i class="fa fa-spinner fa-spin me-2"></i>
                  {{ isEditMode ? 'Actualizando...' : 'Creando...' }}
                </span>
              } @else {
                <span>
                  <i class="fa fa-save me-2"></i>
                  {{ isEditMode ? 'Actualizar Categoría' : 'Crear Categoría' }}
                </span>
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>