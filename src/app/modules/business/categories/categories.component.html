<div class="categories-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div>
        <h1 class="page-title">Categorías</h1>
        <p class="page-subtitle">
          Organiza tus productos en categorías
          @if (planLimits) {
            <span class="usage-badge">
              {{ categories.length }} / {{ planLimits.numeric?.max_categories || planLimits.max_categories }}
            </span>
          }
        </p>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" routerLink="/business/categories/new">
          <i class="fa fa-plus me-2"></i>
          Nueva Categoría
        </button>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-card">
    <div class="filters-content">
      <div class="filters-grid">
        <div class="filter-group">
          <label class="filter-label">Buscar categorías</label>
          <div class="search-container">
            <input
              type="text"
              class="search-input"
              placeholder="Nombre de la categoría..."
              [(ngModel)]="searchTerm"
              (input)="filterCategories()"
            />
            <button class="search-button" type="button">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Categories Grid -->
  <div class="categories-container">
    @if (isLoading) {
      <div class="loading-container">
        <app-loading-spinner message="Cargando categorías..."></app-loading-spinner>
      </div>
    }

    @if (!isLoading && filteredCategories.length === 0) {
      <div class="empty-container">
        <app-empty-state
          icon="folder"
          [title]="categories.length === 0 ? 'Aún no tienes categorías' : 'No hay resultados'"
          [description]="categories.length === 0 ? 'Crea tu primera categoría para organizar tus productos' : 'Intenta con otros términos de búsqueda'"
          actionText="Crear primera categoría"
          actionIcon="plus"
          (onAction)="router.navigate(['/business/categories/new'])">
        </app-empty-state>
      </div>
    }

    @if (!isLoading && filteredCategories.length > 0) {
      <div class="categories-grid">
        @for (category of paginatedCategories; track category.id) {
          <div class="category-card">
            <div class="category-image-container">
              <div 
                class="category-image"
                [style.backgroundImage]="'url(' + (category.cover_image_url || 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?auto=format&fit=crop&w=400&q=80') + ')'">
                <span class="category-status" [class.active]="category.is_active">
                  {{ category.is_active ? 'Activa' : 'Inactiva' }}
                </span>
                <div class="category-product-count">
                  {{ category.product_count || 0 }} productos
                </div>
              </div>
            </div>
            
            <div class="category-content">
              <h3 class="category-title">{{ category.name }}</h3>
              
              @if (category.description) {
                <p class="category-description">
                  {{ category.description | slice:0:100 }}{{ category.description.length > 100 ? '...' : '' }}
                </p>
              }
              
              <div class="category-footer">
                <div class="category-order">
                  <i class="fa fa-sort-numeric-up me-1"></i>
                  Orden: {{ category.display_order }}
                </div>
                <div class="category-actions">
                  <div class="form-check form-switch me-2">
                    <input
                      type="checkbox"
                      class="form-check-input"
                      role="switch"
                      [checked]="category.is_active"
                      (change)="toggleCategoryStatus(category)"
                      title="{{ category.is_active ? 'Desactivar' : 'Activar' }} categoría"
                    />
                  </div>
                  <button 
                    class="btn-action btn-edit" 
                    [routerLink]="['/business/categories', category.id, 'edit']"
                    title="Editar categoría">
                    <i class="fa fa-edit"></i>
                  </button>
                  <button 
                    class="btn-action btn-delete" 
                    (click)="deleteCategory(category)"
                    title="Eliminar categoría">
                    <i class="fa fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Pagination -->
  @if (filteredCategories.length > 0 && !isLoading) {
    <div class="pagination-container">
      <nav class="pagination">
        <button 
          class="pagination-button prev" 
          [disabled]="currentPage === 1"
          (click)="prevPage()">
          <i class="fa fa-chevron-left me-1"></i>
          Anterior
        </button>
        
        <div class="pagination-pages">
          @for (page of getPageNumbers(); track page) {
            <button 
              class="pagination-page" 
              [class.active]="page === currentPage"
              (click)="goToPage(page)">
              {{ page }}
            </button>
          }
        </div>
        
        <button 
          class="pagination-button next" 
          [disabled]="currentPage === totalPages"
          (click)="nextPage()">
          Siguiente
          <i class="fa fa-chevron-right ms-1"></i>
        </button>
      </nav>
    </div>
  }
</div>